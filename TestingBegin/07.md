# 7. Планета смартфонов

## Содержание

+ [7.1 Планета смартфонов](#71-планета-смартфонов)
+ [7.2 Основы тестирования мобильных приложений](#72-основы-тестирования-мобильных-приложений)
+ [7.3 Как работает мобильное приложение](#73-как-работает-мобильное-приложение)
+ [7.4 Основы Android Studio](#74-основы-android-studio)
+ [7.5 Знакомство с Charles Proxy](#75-знакомство-с-charles-proxy)

[Оглавление](/TestingBegin/README.md)

# 7.1 Планета смартфонов

[Планета смартфонов](/TestingBegin/video/7.1.mp4)

<hr>

[Содержание](#содержание)

# 7.2 Основы тестирования мобильных приложений

**Мобильная индустрия развивается крайне быстро.** Последний анализ, проведенный GSMA Intelligence, показывает, что в настоящее время в мире насчитывается **5,56 миллиарда** уникальных абонентов мобильной связи, что составляет **69,1%** мирового населения. За прошедший год использование мобильных телефонов увеличилось на **2,7%**, благодаря почти **150 миллионам** новых пользователей. Естественно, спрос на тестировщиков мобильных приложений растет.

![07](/TestingBegin/img/07_01.png)

## Мобильные приложения

**Мобильное приложение** – программное обеспечение, приспособленное для работы на мобильных платформах О статистике использования мобильных приложений можно почитать в этой статье. Если говорить коротко: мобильные приложения лидируют почти во всех отраслях жизни человека.

## Основные ОС
Android - ОС от Google, основанная на Linux. Код Android является открытым, поэтому её адаптируют под разные типы устройств:

+ смартфоны
+ планшеты
+ IoT приложения
+ SmartTV

iOS - ОС от Apple. В отличие от Android, у неё закрытый код, поэтому iOS есть только на устройствах Apple.

## Виды мобильных приложений

На данный момент можно выделить три основных вида мобильных приложений:

+ **Веб-приложения**, адаптированные под мобильные устройства. Эти приложения также являются кроссплатформенными, не требуют установки и очень просты в использовании. Например, мобильная версия почтового сервиса Gmail, доступная через мобильный веб-браузер.
+ **Нативные приложения**. Такие приложения разрабатываются исключительно для конкретной платформы и максимально используют возможности конкретной операционной системы. Как правило, нативные приложения характеризуются широким набором функций и высокой скоростью работы. Нативные приложения необходимо устанавливать. Например, музыкальное приложение Яндекс.Музыка, доступное как для устройств Apple (iOS), так и для устройств Android.
+ **Гибридные приложения** комбинируют свойства двух предыдущих. Такие приложения необходимо устанавливать, как нативные. Но, в отличие от нативных, гибридные приложения разрабатываются одновременно для нескольких платформ. Также, для обновления таких приложений достаточно добавить изменения на сервер. Например, TripCase — органайзер для планирования путешествий. 

## Особенности тестирования мобильных приложений

**Тестирование мобильных приложений** – это процесс, с помощью которого прикладное ПО, разработанное для портативных мобильных устройств, проверяется на его функциональность, удобство использования и совместимость. Однако, для достижения высокого уровня качества и успешного выпуска приложения, существует ряд особенностей, на которые необходимо обратить внимание в процессе тестирования. Давайте рассмотрим некоторые из них.

+ Гайдлайны для различных платформ:<br>
Каждая платформа (например, Android и iOS) имеет свои гайдлайны, то есть набор правил и рекомендаций, которыми должны следовать разработчики при создании приложений. Тестирование должно учитывать соответствие приложения гайдлайнам, чтобы обеспечить удобство использования и единообразный интерфейс для пользователей на разных платформах.
+ Разрешение и размер экрана:<br>
Различные мобильные устройства имеют разные разрешения экрана, выраженные в количестве пикселей по длине и ширине. Тестирование должно проверить, как приложение адаптируется к различным разрешениям экрана и корректно отображается на всех устройствах.
+ Датчики устройства:<br>
Мобильные устройства оснащены различными датчиками, такими как гироскоп, акселерометр, датчик освещенности, NFC-чип и функции биометрической аутентификации (распознавание отпечатка пальца и лица). Приложение должно быть протестировано на взаимодействие с этими датчиками и функциями, чтобы убедиться, что оно корректно использует доступные возможности устройства.
+ Прерывания работы приложения:<br>
Мобильные устройства могут быть подвержены различным прерываниям во время работы приложения, таким как входящие и исходящие SMS, MMS, звонки, оповещения других приложений. Тестирование должно проверить, как приложение реагирует на эти прерывания и сохраняет свою работоспособность и данные.
+ Параметры связи:<br>
Важной особенностью мобильных приложений является их работа в различных сетевых условиях. Тестирование должно включать проверку работы приложения при разных типах сетей (мобильный интернет, Wi-Fi) и разных скоростях мобильного интернета. Кроме того, необходимо проверить, как приложение ведет себя в авиарежиме, при отключении и подключении сети, Bluetooth, GPS и других сетевых функций.
+ Производительность и ресурсы:<br>
Тестирование мобильных приложений также включает проверку их производительности и использования ресурсов устройства. Важно проверить длительность запуска приложения, количество кадров в секунду при визуализации, расход заряда батареи при работе приложения и в фоновом режиме, а также обнаружение возможных утечек памяти. Это позволит убедиться в эффективности и оптимизации приложения, а также предотвратить сбои и нестабильную работу на устройствах с ограниченными ресурсами.

В заключение, тестирование мобильных приложений требует учета ряда особенностей, таких как:
+ соответствие гайдлайнам,
+ адаптация к различным разрешениям и размерам экрана,
+ взаимодействие с датчиками устройства,
+ обработка прерываний работы приложения,
+ работа в различных сетевых условиях и
+ обеспечение производительности и оптимизации. 

Правильное тестирование учитывает все эти аспекты и помогает команде разработки достичь высокого уровня качества и функциональности своих мобильных приложений.

**P.S.**

Наш курс для тех, кто хочет стать тестировщиком мобильных приложений на Android и iOS - ["Настоящий тестировщик: Баг в мобильном приложении"](https://stepik.org/182328). Решая загадки вместе с детективом Кавычкиным, вы получите необходимую теорию и практические навыки работы с самыми популярными инструментами индустрии: **BrowserStack**, **XCode**, **Android Studio** и **Charles Proxy**.

<hr>

[Содержание](#содержание)

# 7.3 Как работает мобильное приложение

**Метод** — это блок кода, содержащий ряд инструкций. Программа инициирует выполнение инструкций, вызывая метод и указывая все аргументы, необходимые для этого метода.

## Как работает мобильное приложение
Ключевым компонентом для создания визуального интерфейса в приложении является activity (активность). Нередко activity ассоциируется с отдельным экраном или окном приложения, а переключение между окнами будет происходить как перемещение от одной activity к другой. Приложение может иметь одну или несколько activity.

Тестирование activity включает в себя проверку различных аспектов и функций приложения, чтобы убедиться, что они работают правильно и взаимодействуют с пользователем так, как ожидается. Activity имеет различные состояния жизненного цикла, такие как создание, пауза, возобновление и уничтожение. Убедитесь, что приложение правильно управляет этими состояниями и сохраняет состояние при необходимости.

Жизненный цикл activity зависит от ОС. Давайте рассмотрим как работает Android приложение.

![07](/TestingBegin/img/07_02.png)

`onCreate()` — первый метод, с которого начинается выполнение `activity`. В нем производится первоначальная настройка `activity`. В частности, создаются объекты визуального интерфейса.

Также следует отметить, что при изменении ориентации экрана система завершает `activity` и затем создает ее заново, вызывая метод `onCreate()`.

После того как метод `onCreate()` завершил выполнение, `activity` переходит в состояние `Started`, и система вызывает метод `onStart()`.

![07](/TestingBegin/img/07_03.png)

`onStart()` — осуществляется подготовка к выводу `activity` на экран устройства. После завершения работы метода `activity` отображается на экране, вызывается метод `onResume()`, а `activity` переходит в состояние `Resumed`.

![07](/TestingBegin/img/07_04.png)

`onResume()` — при вызове метода `onResume()` `activity` переходит в состояние `Resumed` и отображается на экране устройства, и пользователь может с ней взаимодействовать. И собственно `activity` остается в этом состоянии, пока она не потеряет фокус, например, в следствии переключения на другую `activity` или просто из-за выключения экрана устройства.

![07](/TestingBegin/img/07_05.png)

`onPause()` — если пользователь решит перейти к другой `activity`, то система вызывает метод `onPause()`, а `activity` переходит в состояние `Paused`. В этом методе можно освобождать используемые ресурсы, приостанавливать процессы, например, воспроизведение аудио, анимаций, останавливать работу камеры (если она используется) и т.д., чтобы они меньше сказывались на производительность системы. После выполнения этого метода `activity` становится невидимой, не отображается на экране, но она все еще активна. И если пользователь решит вернуться к этой `activity`, то система вызовет снова метод `onResume()`, и `activity` снова появится на экране.

![07](/TestingBegin/img/07_06.png)

Другой вариант работы может возникнуть, если вдруг система видит, что для работы активных приложений необходимо больше памяти. И система может сама завершить полностью работу `activity`, которая невидима и находится в фоне. В этом случае у `activity` вызывается метод `onStop()`.

Либо пользователь может нажать на кнопку `Back` (Назад). В этом случае у `activity` вызывается метод `onPause()`, а затем метод `onStop()`.

`onStop()` — в этом методе `activity` переходит в состояние `Stopped`. В этом состоянии `activity` полностью невидима. В методе `onStop()` освобождаются используемые ресурсы, которые не нужны пользователю, когда он не взаимодействует с `activity`.

При этом во время состояния `Stopped` `activity` остается в памяти устройства, сохраняется состояние всех элементов интерфейса. К примеру, если в текстовое поле `EditText` был введен какой-то текст, то после возобновления работы `activity` и перехода ее в состояние `Resumed` мы вновь увидим в текстовом поле ранее введенный текст.

Если после вызова метода `onStop()` пользователь решит вернуться к прежней `activity`, тогда система вызовет метод `onRestart()`. Если же `activity` вовсе завершила свою работу, например, из-за закрытия приложения, то вызывается метод `onDestroy()`.

![07](/TestingBegin/img/07_07.png)

`onDestroy()` — ну и завершается работа `activity` вызовом метода `onDestroy()`, который возникает, если система решит убить `activity` в силу конфигурационных причин (например, поворот экрана или при многооконном режиме).

Итак, тестирование `activity` важно для обеспечения качества и функциональности Android-приложений. Проверка этих основных состояний поможет убедиться, что пользовательский интерфейс работает без сбоев и обеспечивает хороший пользовательский опыт.

<hr>

[Содержание](#содержание)

# 7.4 Основы Android Studio

В последнее время эмуляция ОС Android на компьютере стала очень популярной. Пользователям зачастую необязательно знать принципы работы, достаточно просто скачать из Интернета специальный эмулятор с уже установленной ОС на борту и запустить его. Благо эмуляторов сейчас существует большое множество.

Главным преимуществом эмулятора при тестировании является то, что он дает мгновенный доступ к любой версии Android или любому устройству, на котором нужно проверить работу приложения.

К недостатку такого подхода можно отнести то, что нет возможности увидеть, как приложение действительно выглядит на устройстве, например, с AMOLED дисплеем. Также у эмуляторов нет доступа к некоторым аппаратным функциями реальных устройств.

Рассмотрим как установить и работать с эмулятором от Android Studio.

Эмулятор Android может имитировать работу смартфона, планшета, часов Wear OS и устройств Android TV. Он содержит в себе конфигурации популярных типов устройств.

С его помощью можно имитировать входящие звонки и сообщения, указывать местоположение, тестировать различные скорости мобильного интернета, повороты экрана и различные датчики, как у реального устройства. Однако не все возможности поддерживаются эмулятором, в частности он не поддерживает следующее:

+ Bluetooth;
+ NFC;
+ Работу с SD-картой;
+ Работу с наушниками;
+ USB.

Поэтому если вам нужно протестировать что-то из вышеперечисленного, то придется воспользоваться реальным устройством, в остальном же эмулятор полностью повторяет его функционал.

Каждый экземпляр эмулятора использует AVD (Android Virtual Device). AVD — это конфигурация определяет характеристики устройства, которое нужно эмулировать: форм-фактор, версию Android и различные характеристики.

## Настройка

Для начала создадим новый проект и настроим его. На первой странице выбираем “No Activity”:

![07](/TestingBegin/img/07_08.png)

На второй странице указываем название проекта, указываем ЯП нашего приложения и версию Android:

![07](/TestingBegin/img/07_09.png)

Для того чтобы создать новый AVD, нужно запустить Device Manager. Для этого нужно в Android Studio в меню выбрать Tools — Device Manager. Откроется окно менеджера, в котором будет отображаться список созданных эмуляторов.

![07](/TestingBegin/img/07_10.png)

Чтобы создать новый эмулятор, нужно нажать на Create Device в Менеджере AVD. Откроется окно, в котором будет предложено выбрать тип устройства и профиль.

![07](/TestingBegin/img/07_11.png)

После того как будет выбран профиль, нужно нажать на Next для перехода далее. Здесь нужно выбрать, какой образ системы использовать.

![07](/TestingBegin/img/07_12.png)

На вкладке Recommended перечислены рекомендуемые образы системы. Другие вкладки содержат более полный список доступных образов. Справа приводится информация о выбранном образе (уровень API, версия).

Примечание: образы x86 работают на эмуляторе быстрее всего.

Уровень API важен, поскольку если он будет меньше, чем тот, что указан в манифесте приложения, оно не будет установлено на этот эмулятор.

Если образ ранее не был скачан, рядом с названием появится кнопка Download, нажатие на которую начнет процесс скачивания.

Чтобы перейти на следующий этап, нужно нажать Next. В новом окне будет предложено изменить дополнительные свойства AVD (название AVD, ориентацию экрана).

![07](/TestingBegin/img/07_13.png)

После нажатия на Show Advanced Settings откроются дополнительные настройки, в которых можно изменить следующее:

+ Фронтальную/основную камеру. Вместо эмуляции изображения есть возможность использовать в качестве камеры подключенную вебкамеру;
+ Скорость и качество интернет-соединения;
+ Способ загрузки. Если выбрать Quick Boot, то эмулятор будет сохранять текущее состояние при выключении и загружать его при включении. Cold Boot — холодный старт;
+ Количество выделенной оперативной памяти и места на диске;
+ Включение\отключение внешнего вида эмулятора;
+ Включение\отключение ввода с клавиатуры.

Важно! Использование Quick Boot может сильно замедлить работу компьютера, если у него будет недостаточно свободной оперативной памяти для загрузки-сохранения данных. В этом случае лучше использовать Cold Boot.

После того как AVD будет настроен, останется только нажать Finish. После этого созданный AVD можно будет увидеть в окне Менеджера AVD.

Если нужно будет изменить настройки AVD, это легко можно сделать, нажав на кнопку Edit рядом с нужным эмулятором в списке Менеджера AVD.

![07](/TestingBegin/img/07_14.png)

Чтобы запустить эмулятор, достаточно в Менеджере AVD нажать на кнопку Run.

![07](/TestingBegin/img/07_15.png)

## Работа с эмулятором

Установить приложение на эмулятор можно, перетащив APK-файл на экран эмулятора. Можете скачать APK-файлы из https://www.rustore.ru и потренироваться.

Эмулятор Android позволяет тестировать самые разные функции. Их можно настроить, нажав на кнопку Extended Controls в меню рядом с эмулятором.

![07](/TestingBegin/img/07_16.png)

Откроется окно с настройками, разбитыми на различные категории. Здесь можно настроить отправку данных, различные свойства устройства и так далее. Рассмотрим некоторые из категорий.

Вкладка Location позволяет симулировать изменение местоположения устройства. В этом окне можно задавать широту, долготу и высоту и отслеживать изменение координат.

![07](/TestingBegin/img/07_17.png)

Вкладка Cellular содержит параметры, регулирующие качество связи и мобильного интернета. Например, можно настроить тип сети, выбрав LTE, GPRS или другие варианты, силу сигнала и домашний регион/роуминг.

![07](/TestingBegin/img/07_18.png)

На вкладке Battery можно установить уровень заряда батареи и ее состояние (заряжается, разряжается и так далее).

![07](/TestingBegin/img/07_19.png)

Вкладка Phone позволяет симулировать входящие звонки и смс-сообщения.

![07](/TestingBegin/img/07_20.png)

Для того чтобы отправить входящий вызов, достаточно нажать на кнопку Call device, после чего на эмуляторе появится соответствующее уведомление. При желании можно также задать свой номер телефона.

Аналогичным образом можно отправить текстовое сообщение, введя текст сообщения в поле SMS Message и нажав Send Message.

На вкладке Fingerprint можно симулировать использование датчика отпечатков. На выбор предлагается несколько предустановленных отпечатков пальцев для различных тестов. Чтобы сообщить датчику о том, что пользователь прикладывает палец, нужно нажать на кнопку Touch the sensor.

![07](/TestingBegin/img/07_21.png)

Вкладка Virtual sensors отвечает за симуляцию работы различных датчиков, таких как гироскоп, акселерометр и магнитометр.

![07](/TestingBegin/img/07_22.png)

С их помощью можно тестировать приложение на предмет изменения положения устройства в пространстве, ориентации или того и другого. Эмулятор имитирует способ реагирования датчиков акселерометра и магнитометра при перемещении или повороте реального устройства.

**P.S.**

Сегодня мы познакомились с инструментом для тестирования мобильных приложений на Android. Android Studio является мощным инструментом с огромным количеством возможностей. Чтобы узнать о всех возможностях, следует изучить документацию - https://developer.android.com/studio/intro, или пройти наш курс ["Настоящий тестировщик: Баг в мобильном приложении"](https://stepik.org/182328).

## Практическое задание 4:

Вам предстоит провести негативное тестирование формы регистрации в любом мобильном приложении с использованием Android Studio: указать неверные логин и пароль, чтобы получить ошибку авторизации.

Скриншот полученного результата укажите в комментарии.

<hr>

[Содержание](#содержание)

# 7.5 Знакомство с Charles Proxy

В уроке про тестирование API мы узнали, что с помощью вкладки Network у DevTools мы можем отследить взаимодействие клиента и сервера. Дело в том, что браузеры смартфонов не имеют DevTools. Да и тестировать взаимодействие мобильного приложения с сервером также необходимо. Для мониторинга трафика используются специальные инструменты - снифферы.

**Снифферы** - это инструменты позволящие перехватывать и анализировать сетевой трафик между устройством и сервером.

## Настройка Charles Proxy для Android

Давайте настроим Charles Proxy. Во-первых, нам нужно скачать сертификат, с помощью которого наш телефон будет взаимодействовать со сниффером. Во вторых, устройство Android и ПК должны быть в одной сети.

Переходим в раздел Help > SSL Proxying > Install Charles Root Certificate.

![07](/TestingBegin/img/07_23.png)

В открывшемся окне Сертификат > Установить сертификат. Выбрать «Текущий пользователь» или «Локальный пользователь». Далее вы получите уведомление, что сертификат успешно импортирован.

![07](/TestingBegin/img/07_24.png)

Для перехвата трафика у Android-приложения должно быть установлено разрешение в файле манифесте - **AndroidManifest.xml**, который настраивают разработчики приложения. В файле манифесте указывают разрешения, которые сторонние приложения обязаны иметь для взаимодействия с компонентами данного приложения. Кстати,  можете скачать APK-файлы из https://www.rustore.ru и потренироваться.

Теперь настроим сеть. Для этого узнаем IP-адрес ПК: в Charles Proxy перейдем в Help > Local IP Address. Видим, что наш IP: 192.168.60.159

![07](/TestingBegin/img/07_25.png)

Далее на телефоне идем в Свойства сети → Название сети WiFi → Прокси-сервер

Выбираем вариант вручную и прописываем параметры:

+ Имя хоста: IP-адрес нашего компьютера;
+ Порт: 8888

![07](/TestingBegin/img/07_26.png)

При сохранении в Charles на ПК появится запрос, нажимаем Allow.

![07](/TestingBegin/img/07_27.png)

Теперь необходимо на телефоне перейти по ссылке chls.pro/ssl, начнется скачивание сертификата. После успешной загрузки нужно перейти в настройки и найти пункт установка сертификата, нам нужен Сертификат СА. После чего, выбираем скаченный сертификат и устанавливаем.

Все! Ваш телефон готов для сниффинга.

## Работа со сниффером 

Для мониторинга трафика понадобятся следующие кнопки:

![07](/TestingBegin/img/07_28.png)

+ Clear the current Session — очищает историю запросов.
+ Start/Stop Recording — включает или выключает записи запросов.
+ Start/Stop SSL Proxying — включает или выключает просмотр запросов.

На вкладке Structure будут видны запросы отправляемые с вашего устройства, которые можно фильтровать:

![07](/TestingBegin/img/07_29.png)

На вкладке Sequence также будут видны запросы отправляемые с вашего устройства, которые можно фильтровать. Интерфейс данной вкладки напоминает вкладку Network у DevTools:

![07](/TestingBegin/img/07_30.png)

И на вкладке Structure, и на вкладке Sequence можно узнать подробную информацию каждого запроса, нажав на него:

+ `Overview` - общая информация, которая доступна о запросе.
+ `Contetns` - основная вкладка, на которой отображается содержимое запросов/ответов.
+ `Summary` — информация для сравнения группы запросов.
+ `Chart` — диаграмма о времени выполнения группы запросов.
+ `Notes` — личные заметки о запросе.

**P.S.**

На этом наше знакомство со сниффингом подошло к концу. Charles Proxy позволяет не только мониторить трафик, но и настраивать запросы и ответы. Чтобы освоить Charles Proxy в полной мере, советуем ознакомиться с докуметацией инструмента - https://www.charlesproxy.com/documentation/, или пройти наш курс ["Настоящий тестировщик: Баг в мобильном приложении"](https://stepik.org/182328).

<hr>

[Содержание](#содержание)